# Time Count Generator

| Name                          | In/Out | Width | Description                                         | 
| ----------------------------- | ------ | ----- | --------------------------------------------------- | 
| CLK                           | In     | 1     | 20.48MHzクロック                                    | 
| SYS_TIME                      | 64     | 1     | システム時刻                                        | 
| SKIP_ONE_ASSERT               | In     | 1     | [Synchonizer](./sync.md)参照                        | 
| TIME_CNT                      | Out    | 9     | $\SI{9}{bit}$カウンタ                               | 
| UPDATE                        | Out    | 1     | $\SI{40}{kHz}$周期トリガ                            | 

このモジュールは, 同期システム時刻 `SYS_TIME`から, 離散時刻$t = 0, ..., 511$ (`TIME_CNT`) と$\SI{40}{kHz}$周波数で発火する`UPDATE`を生成する.
`SYS_TIME`は$\SI{20.48}{MHz}$でカウントアップされる$\SI{64}{bit}$符号なし整数カウンタである.
`SYS_TIME`の値は, 全デバイス間で同期しているため, $t$も必然的に全てのデバイスの全振動子で同期する.
`SYS_TIME`に関しては, [Synchonizer](./sync.md)を参照されたい.

`TIME_CNT`の生成には, `SYS_TIME`の下位9bitをそのまま使用する.
また, `UPDATE`は基本的に`TIME_CNT`が特定の値のときだけ$1$とすれば良い.
ただし, `SYS_TIME`は補正のために, 値が1飛ばしでインクリメント (すなわち前回の値$+2$) される, または, インクリメントされない可能性があるため, 単純に`UPDATE`は`TIME_CNT`が$0$のときに$1$のようにすることができない.
そのため, `UPDATE`がアサートされるのは, `TIME_CNT`が$511$から$0$または$1$に変化するタイミング, としている.
(すなわち, `UPDATE`がアサートされたクロックの次のクロックから`TIME_CNT`がリセットされ, 新しい周期が始まるようになっている.) 
